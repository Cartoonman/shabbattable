{% extends "frijay/base.html" %}
{% load staticfiles %}
{% load reserv_exists %}
{% load is_host %}
{% load fetch_reservation %}


{% block title %}Events Page{% endblock %}
{% block body %}
<br>
<br>
<h1>Events</h1>
{% autoescape off %}
{% for event in html_list %}
    <div class="col-sm-4 col-md-3">
        <div class="thumbnail">
            <img src="{% static "images/image2.jpg" %}" alt="My image" />
            <div class="caption">
                <div class="well well-sm">
                    <a href="/frijay/events/{{event.id}}"><h3>{{event.title}}</h3></a>
                </div>

                {% if user.is_authenticated %}
                    {% reservation_exists user event as exists %}
                    {% is_host event.title user as host %}
                    {% if host %}
                <a style="text-decoration: none;" href="{% url 'myevents' %}"><span class="label label-info">You're The Host</span></a>
                    {% elif exists is False %}
                    <form method="POST">{% csrf_token %}
                        <button type="submit" class="btn btn-primary" value="{{event.title}}" name = "reserve">Reserve a Seat</button>
                    </form>
                    {% else %}
                        {% fetch_reservation event.title user as res %}
                        {% if res.accept is None %}
                        <a style="text-decoration: none;" href="{% url 'reservation' %}"><span class="label label-warning">Request Sent - Pending Approval from Host</span></a>
                        {% elif res.accept %}
                        <a style="text-decoration: none;" href="{% url 'reservation' %}"><span class="label label-success">Reservation Approved!</span></a>
                        {% elif not res.accept %}
                        <a style="text-decoration: none;" href="{% url 'reservation' %}"><span class="label label-danger">Reservation Declined by Host</span></a>
                        {% endif %}
                {% endif %}
                {% else %}
                    <a href="{% url 'login' %}?next=/frijay/events/", class="btn btn-primary">RSVP</a>
                {% endif %}
            </div>
        </div>
    </div>
{% endfor %}
     <div style="clear:both"></div>

{% endautoescape %}
{% endblock %}
